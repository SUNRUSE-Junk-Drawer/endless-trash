import { BodyParserResult } from "@endless-trash/body-parser";
import { Json } from "@endless-trash/immutable-json-type";
import { jsonBodyParser } from "..";

describe(`jsonBodyParser`, () => {
  describe(`on execution`, () => {
    describe(`when the input contains invalid text`, () => {
      let result: BodyParserResult<Json>;

      beforeAll(async () => {
        result = await jsonBodyParser(
          Buffer.from(
            Uint8Array.from([
              0x48,
              0x65,
              0x6c,
              0x6c,
              0x6f,
              0x20,
              0xff,
              0x20,
              0x77,
              0x6f,
              0x72,
              0x6c,
              0x64,
            ])
          )
        );
      });

      it(`returns unsuccessfully`, () => {
        expect(result).toEqual({ type: `unsuccessful` });
      });
    });

    describe(`when the input contains valid text which is invalid JSON`, () => {
      let result: BodyParserResult<Json>;

      beforeAll(async () => {
        result = await jsonBodyParser(
          Buffer.from(
            Uint8Array.from([
              0x7b,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x22,
              0x74,
              0x65,
              0x73,
              0x74,
              0x42,
              0x6f,
              0x64,
              0x79,
              0x41,
              0x22,
              0x3a,
              0x20,
              0x7b,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x22,
              0x74,
              0x65,
              0x73,
              0x74,
              0x42,
              0x6f,
              0x64,
              0x79,
              0x42,
              0x22,
              0x3a,
              0x20,
              0x7b,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x22,
              0x74,
              0x65,
              0x73,
              0x74,
              0x42,
              0x6f,
              0x64,
              0x79,
              0x43,
              0x22,
              0x3a,
              0x20,
              0x5b,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x74,
              0x72,
              0x75,
              0x65,
              0x2c,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x66,
              0x61,
              0x6c,
              0x73,
              0x65,
              0x2c,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x6e,
              0x75,
              0x6c,
              0x6c,
              0x2c,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x34,
              0x2e,
              0x33,
              0x32,
              0x2c,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x22,
              0x54,
              0x65,
              0x73,
              0x74,
              0x20,
              0x53,
              0x74,
              0x72,
              0x69,
              0x6e,
              0x67,
              0x22,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x5d,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x7d,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x7d,
              0x0a,
            ])
          )
        );
      });

      it(`returns unsuccessfully`, () => {
        expect(result).toEqual({
          type: `unsuccessful`,
        });
      });
    });

    describe(`when the input contains valid JSON`, () => {
      let result: BodyParserResult<Json>;

      beforeAll(async () => {
        result = await jsonBodyParser(
          Buffer.from(
            Uint8Array.from([
              0x7b,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x22,
              0x74,
              0x65,
              0x73,
              0x74,
              0x42,
              0x6f,
              0x64,
              0x79,
              0x41,
              0x22,
              0x3a,
              0x20,
              0x7b,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x22,
              0x74,
              0x65,
              0x73,
              0x74,
              0x42,
              0x6f,
              0x64,
              0x79,
              0x42,
              0x22,
              0x3a,
              0x20,
              0x7b,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x22,
              0x74,
              0x65,
              0x73,
              0x74,
              0x42,
              0x6f,
              0x64,
              0x79,
              0x43,
              0x22,
              0x3a,
              0x20,
              0x5b,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x74,
              0x72,
              0x75,
              0x65,
              0x2c,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x66,
              0x61,
              0x6c,
              0x73,
              0x65,
              0x2c,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x6e,
              0x75,
              0x6c,
              0x6c,
              0x2c,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x34,
              0x2e,
              0x33,
              0x32,
              0x2c,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x22,
              0x54,
              0x65,
              0x73,
              0x74,
              0x20,
              0x53,
              0x74,
              0x72,
              0x69,
              0x6e,
              0x67,
              0x22,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x5d,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x7d,
              0x0a,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x20,
              0x7d,
              0x0a,
              0x7d,
            ])
          )
        );
      });

      it(`returns successfully`, () => {
        expect(result).toEqual({
          type: `successful`,
          body: {
            testBodyA: {
              testBodyB: {
                testBodyC: [true, false, null, 4.32, `Test String`],
              },
            },
          },
        } as BodyParserResult<Json>);
      });
    });
  });
});
